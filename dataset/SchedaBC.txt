package unisa.gps.etour.gui.operatoreagenzia;

import java.awt .*;
import java.awt.event .*;
import java.rmi.RemoteException;
import java.rmi.registry.LocateRegistry;
import java.rmi.registry.Registry;
import java.util.ArrayList;
import java.util.Date;
import java.util.HashMap;
import java.util.Iterator;
import java.util.StringTokenizer;
import java.util.Vector;
import javax.swing .*;
import java.util .*;
import javax.swing.table.TableColumn;
import javax.swing.text.JTextComponent;
import javax.swing.border .*;
import unisa.gps.etour.bean.BeanBeneCulturale;
import unisa.gps.etour.bean.BeanTag;
import unisa.gps.etour.bean.BeanVisitaBC;
import unisa.gps.etour.control.GestioneBeniCulturali.IGestioneBeniCulturaliAgenzia;
import unisa.gps.etour.control.GestioneTag.IGestioneTagComune;
import unisa.gps.etour.gui.operatoreagenzia.document.LimitedDocument;
import unisa.gps.etour.gui.operatoreagenzia.document.NumericDocument;
import unisa.gps.etour.gui.operatoreagenzia.document.OnlyCharactersDocument;
import unisa.gps.etour.gui.operatoreagenzia.tables.FeedBackTableModel;
import unisa.gps.etour.gui.operatoreagenzia.tables.MediaVotiRenderer;
import unisa.gps.etour.util.Punto3D;


/ **
  * Class that models the interface for viewing the card,
  * Modify the data and the insertion of a new cultural object.
  *
  * @ Version 1.0
  * @ Author Mario Gallo
  *
  * © 2007 eTour Project - Copyright by DMI SE @ SA Lab --
  * University of Salerno
  *
  * /
public class SchedaBC extends JInternalFrame implements IScheda
(

private static final String [] txts = ( "Name", "Address", "City", "Location", "CAP"
"Province", "Geographical Location", "Phone",
"Opening Hours", "Closing Time"
"Closing Date", "Ticket price", "Description");
private static final String [] help = (
"Enter the name of cultural property."
"Enter the address where is located the cultural property."
"Enter the city 'where is located the cultural property."
"Enter the location 'of membership of a cultural object."
"Enter your zip code, the area where the cultural object is located."
"Select the province belonging to the cultural property."
"Incorporating three dimensional coordinates for the location of" +
"cultural heritage."
"Enter the phone for delivery of the cultural management office."
"Select the time of public opening of the cultural property."
"Select the closing time for the public of cultural property."
"Select the weekly closing day."
"Give the ticket price of admission to cultural property."
"<html> Enter a full and comprehensive description for the cultural property. <br> Please note that this" +
"description will be used as a source of keywords <br> in research by" +
"tourists </ html>"
"<html> Select the search tags for cultural property. <br> search tags allow tourists to seek" +
"The sites with the features of interest. </ Html>");
private JPanel jContentPane = null;
Private JToolBar toolbarSchedaBC = null;
Private JToggleButton btnModifica = null;
private JButton btnSalva = null;
private JButton btnAnnulla = null;
private JButton btnModificaCommento = null;
private JTabbedPane JTabbedPane = null;
private JPanel statistics = null;
private JPanel feedback = null;
private JTextField address2 = null;
private JComboBox Address1 = null;
private JTextField cittaBC = null;
private JTextField localitaBC = null;
private JTextField capBC = null;
private JTextField posGeoX = null;
private JScrollPane JScrollPane = null;
private JTextArea descrizioneBC = null;
private JTextField telefonoBC = null;
private JComboBox oreAP = null;
private JComboBox minAP = null;
Private TagPanel pannelloTag;
private JTextField costoBC = null;
private JComboBox Oreca = null;
private JComboBox mince = null;
private JComboBox provBC = null;
private JPanel datiBC = null;
private JTextField nomeBC = null;
private JScrollPane scrollPaneFeedback = null;
private JTable tableFeedback = null;
private JLabel txtNomeBene = null;
private JLabel mediaVotoBC = null;
private JPanel statMeseCorrente = null;
private JPanel statTotali = null;
private JTextField posGeoY = null;
private JTextField posGeoZ = null;
private Vector <JLabel> suggestions;
Private BeanBeneCulturale bc;
private JComboBox giornoChiusura;
private JLabel [] statMeseC;
private JLabel [] statt;
Private Beniculturali parent;
Private FeedBackTableModel feedbackModel;
protected IGestioneTagComune tags;
protected IGestioneBeniCulturaliAgenzia gestioneBC;
private ArrayList <Integer> idTag = null;

/ **
* The default constructor for inclusion of the interface model
* A new cultural object.
*
* /
public SchedaBC (Beniculturali pParent)
(
super ( "New Cultural Heritage");
frameIcon = new ImageIcon (getClass (). getResource (
Home.URL_IMAGES + "nuovoBC.png"));
closable = true;
resizable = false;
iconable = true;
setSize (600, 560);
setDefaultCloseOperation (WindowConstants.DO_NOTHING_ON_CLOSE);
suggestions <JLabel> = new Vector ();
parent = pParent;
bc = null;

/ / Initialize the content pane
jContentPane = new JPanel ();
jContentPane.setLayout (new BorderLayout ());
jContentPane.add (getToolbarSchedaBC (), BorderLayout.CENTER);
JTabbedPane = new JTabbedPane ();
jTabbedPane.addTab ( "Data Cultural Heritage"
new ImageIcon (getClass (). getResource (
Home.URL_IMAGES + "dati.png")),
getDatiBCForm (), null);
jContentPane.add (JTabbedPane, BorderLayout.CENTER);
setContentPane (jContentPane);

/ / Dialog closure to close the entry window.
addInternalFrameListener (new InternalFrameAdapter ()
(
/ *
* Inclusion of the frame on the desktop desktop retrieves bread bread
* And desktop manager and initializes the remote objects for managing
* Cultural heritage.
* /

public void internalFrameOpened (InternalFrameEvent pEvent)
(
PEvent.getInternalFrame JInternalFrame frame = ();

/ / Setting up of remote objects for the management of cultural heritage.
TRY
(
Registry reg = LocateRegistry.getRegistry (Home.HOST);
tag =
(IGestioneTagComune) reg.lookup (GestioneTagComune ");
gestioneBC =
(IGestioneBeniCulturaliAgenzia) reg.lookup (GestioneBeniCulturaliAgenzia ");
/ / Load data.
caricaTags ();
)
/ *
* Two exceptions: RemoteException and NotBoundException. The
* Result is the same. The management is not operable and
* After the error message window closes.
* /
catch (Exception ex)
(
JLabel error = new JLabel (
"<html> <h2> Unable to communicate with the server eTour. </ h2>"
+ "<h3> <u> Card for entering a new cultural asset will be closed. </ U> </ h3>"
+ "<p> <b> Possible Causes: </ b>"
+ "<ul> <li> No connection to the network. </ Li>"
+ "Server <li> inactive. </ Li>"
+ "Server <li> clogged. </ Li> </ ul>"
+ "<p> Please try again later. </ P>"
+ "<p> If the error persists, please contact technical support. </ P>"
+ "<p> We apologize for the inconvenience. </ Html>");
Err = new ImageIcon ImageIcon (getClass (). GetResource (
Home.URL_IMAGES + "error48.png"));
JOptionPane.showMessageDialog (frame, error,
"Error!" JOptionPane.ERROR_MESSAGE, err);
frame.dispose ();
)
)

public void internalFrameClosing(InternalFrameEvent pEvent) {
    JPanel root = new JPanel(new BorderLayout());
    JLabel message = new JLabel(
            "Are you sure you want to cancel the creation of a new cultural asset?");
    message.setFont(new Font("Dialog", Font.BOLD, 14));
    JLabel alert = new JLabel(
            "Warning! Unsaved data will be lost.", SwingConstants.CENTER);
    alert.setIcon(new ImageIcon(getClass().getResource(
            Home.URL_IMAGES + "warning16.png")));
    root.add(message, BorderLayout.NORTH);
    root.add(alert, BorderLayout.CENTER);
    String[] options = {"Close", "Cancel"};
    int choice = JOptionPane.showInternalOptionDialog(jContentPane, root,
            "Confirm closure",
            JOptionPane.OK_CANCEL_OPTION, JOptionPane.QUESTION_MESSAGE, frameIcon, options, options[1]);
    if (choice == JOptionPane.OK_OPTION) {
        parent.closeScheda((SchedaBC) pEvent.getInternalFrame());
    }
}

// Initialize button
btnModify.setVisible(false);
btnSave.setVisible(true);
btnCancel.setVisible(true);
btnCancel.setText("Clear");

)

/**
 * This interface models the form for modifying data and
 * Displaying the tab of a cultural asset.
 *
 * @param BeanCulturalAsset pbc - the bean containing the data of
 * Selected cultural asset.
 * @param boolean pModify <ul> <li> true - the fields will be editable, and then you can
 * Edit the data of a cultural asset. <li> False - the fields will not be
 * Editable, and then you are viewing the tab of a cultural asset. </ Ul>
 *
 */
public CulturalCard(AssetsParent pParent, BeanCulturalAsset PBC, boolean pModify) {
    super();
    frameIcon = new ImageIcon(getClass().getResource(
            Home.URL_IMAGES + "tab.png"));
    closable = true;
    resizable = false;
    iconable = true;
    setSize(600, 560);
    setDefaultCloseOperation(WindowConstants.DO_NOTHING_ON_CLOSE);

    // Initialize instance variables
    ca = pbc;
    this.parent = pParent;
    suggestions = new Vector<>();
    initializeCulturalCard();

    if (pModify) // If modifying the cultural asset.
    {
        btnModify.setSelected(true);
        btnSave.setVisible(true);
        btnCancel.setVisible(true);
        btnCancel.setText("Reset");
    } else // If viewing the tab of a cultural asset.
    {
        showHideSuggestions();
        enableDisableEdit();
    }
}


/ **
* This method returns the id of the cultural property for which you are viewing the
* Contact or changing data.
*
* @ Return int - the id of the cultural property.
*
* /
public int getId ()
(
if (bc == null)
(
return -1;
)
bc.getId return ();
)

/**
 * This method returns the id of the cultural asset for which you are viewing the
 * Details or modifying data.
 *
 * @return int - the id of the cultural asset.
 *
 */
public int getId() {
    if (ca == null) {
        return -1;
    }
    return ca.getId();
}

/**
 * This method initializes the interface for displaying the tab of a cultural asset.
 */
private void initializeCulturalCard() {
    setTitle(ca.getName());

    // Dialog closed frame
    addInternalFrameListener(new InternalFrameAdapter()) {
        /*
         * Inclusion of the frame on the desktop desktop retrieves bread bread
         * And desktop manager and initializes the remote objects for managing
         * Cultural assets.
         */
    }
    }

public void internalFrameOpened (InternalFrameEvent pEvent)
(
PEvent.getInternalFrame JInternalFrame frame = ();

/ / Setting up of remote objects for the management of cultural heritage.
TRY
(
Registry reg = LocateRegistry.getRegistry (Home.HOST);
tag =
(IGestioneTagComune) reg.lookup (GestioneTagComune ");
gestioneBC =
(IGestioneBeniCulturaliAgenzia) reg.lookup (GestioneBeniCulturaliAgenzia ");
/ / Load data.
caricaTags ();
caricaStatistiche ();
)
/ *
* Two exceptions: RemoteException and NotBoundException. The
* Result is the same. The management is not operable and
* After the error message window closes.
* /
catch (Exception ex)
(
JLabel error = new JLabel (
"<html> <h2> Unable to communicate with the server eTour. </ h2>"
+ "<h3> <u> The board of the cultural inquiry will be closed. </ U> </ h3>"
+ "<p> <b> Possible Causes: </ b>"
+ "<ul> <li> No connection to the network. </ Li>"
+ "Server <li> inactive. </ Li>"
+ "Server <li> clogged. </ Li> </ ul>"
+ "<p> Please try again later. </ P>"
+ "<p> If the error persists, please contact technical support. </ P>"
+ "<p> We apologize for the inconvenience. </ Html>");
Err = new ImageIcon ImageIcon (getClass (). GetResource (
Home.URL_IMAGES + "error48.png"));
JOptionPane.showMessageDialog (frame, error,
"Error!" JOptionPane.ERROR_MESSAGE, err);
frame.dispose ();
)
)

public void internalFrameClosing (InternalFrameEvent pEvent)
(
/ / If you are an amendment asks for confirmation.
if (btnModifica.isSelected ())
(
Root = new JPanel JPanel (new BorderLayout ());
JLabel message = new JLabel (
"Are you sure you want to close the tab of this cultural asset?");
message.setFont (new Font ( "Dialog", Font.BOLD, 14));
JLabel alert = new JLabel (
"Warning! Unsaved data will be lost." SwingConstants.CENTER);
avviso.setIcon (new ImageIcon (getClass (). getResource (
Home.URL_IMAGES + "warning16.png ")));
root.add (message, BorderLayout.NORTH);
root.add (notice, BorderLayout.CENTER);
String [] options = ( "Close", "Cancel");
int choice = JOptionPane.showInternalOptionDialog (jContentPane, root,
"Confirm closing tab Cultural Heritage" bc.getNome + (),
JOptionPane.OK_CANCEL_OPTION, JOptionPane.QUESTION_MESSAGE, frameIcon, options, options [1]);
if (choice == JOptionPane.OK_OPTION)
(
parent.closeScheda ((SchedaBC) pEvent.getInternalFrame ());
)
)
/ / Otherwise directly closes the window.
else
(
parent.closeScheda ((SchedaBC) pEvent.getInternalFrame ());
)
)
));

/ / Initialize the content pane.
jContentPane = new JPanel ();
jContentPane.setLayout (new BorderLayout ());
jContentPane.add (getToolbarSchedaBC (), BorderLayout.CENTER);
JTabbedPane = new JTabbedPane ();
jTabbedPane.addTab ( "Data Cultural Heritage"
new ImageIcon (getClass (). getResource (
Home.URL_IMAGES + "dati.png")),
getDatiBCForm (), null);
New = new JScrollPane JScrollPane (getStatistiche ());
nuovo.setVerticalScrollBarPolicy (JScrollPane.VERTICAL_SCROLLBAR_ALWAYS);
jTabbedPane.addTab ( "Statistics"
new ImageIcon (getClass (). getResource (
Home.URL_IMAGES + "stat24.png")), new, null);
jTabbedPane.addTab ( "Feedback received"
new ImageIcon (getClass (). getResource (
Home.URL_IMAGES + "feedback.png")),
getFeedback (), null);
jContentPane.add (JTabbedPane, BorderLayout.CENTER);
setContentPane (jContentPane);
jTabbedPane.addChangeListener (new ChangeListener ()
(

public void stateChanged (ChangeEvent pChange)
(
/ / Data cultural
if (jTabbedPane.getSelectedIndex () == 0)
(
toolbarSchedaBC.setVisible (true);
btnModifica.setVisible (true);
if (btnModifica.isSelected ())
(
btnSalva.setVisible (true);
btnAnnulla.setVisible (true);
)
btnModificaCommento.setVisible (false);
)
/ / Statistics
else if (jTabbedPane.getSelectedIndex () == 1)
(
toolbarSchedaBC.setVisible (false);
)
/ / Feedback received
else
(
if (btnModifica.isSelected ())
(
btnSalva.setVisible (false);
btnAnnulla.setVisible (false);
)
toolbarSchedaBC.setVisible (true);
btnModificaCommento.setVisible (true);
btnModifica.setVisible (false);

)

)

));

/ / Load the data of the cultural and statistics.
caricaDatiForm ();
)

/ **
*
* This method loads the data supplied to the constructor of the cultural
* In the form.
*
* /
private void caricaDatiForm ()
(
nomeBC.setText (bc.getNome ());
capBC.setText (bc.getCap ());
cittaBC.setText (bc.getCitta ());
costoBC.setText ( "" + bc.getCostoBiglietto ());
descrizioneBC.setText (bc.getDescrizione ());
StringTokenizer tokenizer = new StringTokenizer (bc.getVia ());
String string = tokenizer.nextToken ();
indirizzo1.setSelectedItem (string);
indirizzo2.setText (bc.getVia (). substring (stringa.length ()));
provBC.setSelectedItem (bc.getProvincia ());
Punto3D pos = bc.getPosizione ();
posGeoX.setText ( "" + pos.getLatitudine ());
posGeoY.setText ( "" + pos.getLongitudine ());
posGeoZ.setText ( "" + pos.getAltitudine ());
telefonoBC.setText (bc.getTelefono ());
int minutes = bc.getOrarioApertura (). getMinutes ();
if (minutes == 0)
(
minAP.setSelectedIndex (0);
)
else
(
minAP.setSelectedItem (minutes);
)
int hours = bc.getOrarioApertura (). getHours ();
if (hours <10)
(
oreAP.setSelectedItem ( "0" + hours);
)
else
(
oreAP.setSelectedItem (hours);
)
bc.getOrarioChiusura minutes = (). getMinutes ();
if (minutes == 0)
(
minCH.setSelectedIndex (0);
)
else
(
minCH.setSelectedItem (minutes);
)
bc.getOrarioChiusura hours = (). getHours ();
if (hours <10)
(
oreCH.setSelectedItem ( "0" + hours);
)
else
(
oreCH.setSelectedItem (hours);
)
)

/**
 * This method loads the cultural statistics provided
 * as input to the class constructor.
 */
private void loadStatistics() {
    txtAssetName.setText(ca.getName());
    double rating = ca.getAverageRating();
    if (rating >= 4) {
        ratingIcon.setIcon(new ImageIcon(getClass().getResource(
                Home.URL_IMAGES + "star5.gif")));
    } else if (rating < 4 && rating >= 3) {
        ratingIcon.setIcon(new ImageIcon(getClass().getResource(
                Home.URL_IMAGES + "star4.gif")));
    } else if (rating < 3 && rating >= 2) {
        ratingIcon.setIcon(new ImageIcon(getClass().getResource(
                Home.URL_IMAGES + "star3.gif")));
    } else if (rating < 2 && rating >= 1) {
        ratingIcon.setIcon(new ImageIcon(getClass().getResource(
                Home.URL_IMAGES + "star2.gif")));
    } else {
        ratingIcon.setIcon(new ImageIcon(getClass().getResource(
                Home.URL_IMAGES + "star1.gif")));
    }

    ArrayList<Integer> stats = null;
    try {
        stats = assetManager.getAssetStatistics(ca.getId());
    } catch (RemoteException e) {
        // Handle RemoteException
    }
    monthStats[0].setText("" + stats.get(0));
    monthStats[1].setText("" + stats.get(1));
    monthStats[2].setText("" + stats.get(2));
    monthStats[3].setText("" + stats.get(3));
    monthStats[4].setText("" + stats.get(4));
    monthStats[5].setText("" + stats.get(5));
    // END TEST
}

/**
 * This method shows or hides the labels next to the suggestions
 * in the form.
 */
private void showHideSuggestions() {
    Iterator<JLabel> iterator = suggestions.iterator();
    while (iterator.hasNext()) {
        JLabel current = iterator.next();
        current.setVisible(!current.isVisible());
    }
}


/**
 * This method enables or disables form editing.
 */
private void enableDisableEdit() {
    Component[] components = dataBC.getComponents();
    for (int i = 0; i < components.length; i++) {
        Component current = components[i];
        if (current instanceof JTextField) {
            JTextField textField = (JTextField) current;
            textField.setEditable(!textField.isEditable());
            textField.setBackground(Color.white);
        } else if (current instanceof JComboBox) {
            JComboBox comboBox = (JComboBox) current;
            comboBox.setEnabled(!comboBox.isEnabled());
        }
    }
    descriptionBC.setEditable(!descriptionBC.isEditable());
    tagPanel.enableDisable();
}

/**
 * This method initializes the toolbar for the cultural object tab.
 *
 * @return javax.swing.JToolBar - the toolbar.
 */
private JToolBar getToolbarAssetTab() {
    if (null == assetTabToolbar) {
        assetTabToolbar = new JToolBar();
        assetTabToolbar.setFloatable(false);
        assetTabToolbar.add(getEditButton());
        assetTabToolbar.addSeparator();
        assetTabToolbar.add(getSaveButton());
        assetTabToolbar.addSeparator();
        assetTabToolbar.add(getCancelButton());
        assetTabToolbar.addSeparator();
        if (ca != null) {
            assetTabToolbar.add(getEditCommentButton());
            assetTabToolbar.addSeparator();
        }
    }
    return assetTabToolbar;
}

/**
 * This method initializes the button to modify cultural asset data.
 *
 * @return javax.swing.JToggleButton - the edit button.
 */
private JToggleButton getEditButton() {
    if (null == editButton) {
        editButton = new JToggleButton();
        editButton.setText("Edit Data");
        editButton.setIcon(new ImageIcon(getClass().getResource(Home.URL_IMAGES + "EditBC32.png")));
        editButton.setCursor(Cursor.getPredefinedCursor(Cursor.HAND_CURSOR));
        editButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent arg0) {
                showHideSuggestions();
                enableDisableEdit();
                saveButton.setVisible(editButton.isSelected());
                cancelButton.setVisible(editButton.isSelected());
            }
        });
    }
    return editButton;
}

/**
 * This method initializes the save button.
 *
 * @return javax.swing.JButton
 */
private JButton getSaveButton() {
    if (null == saveButton) {
        saveButton = new JButton();
        saveButton.setText("Save");
        saveButton.setIcon(new ImageIcon(getClass().getResource(Home.URL_IMAGES + "save.png")));
        saveButton.setVisible(false);
        saveButton.setCursor(Cursor.getPredefinedCursor(Cursor.HAND_CURSOR));
        saveButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent pEvent) {
                if (ca == null) {
                    ca = fillBeanWithData();
                    try {
                        assetManager.insertCulturalAsset(ca);
                    } catch (RemoteException ex) {
                        ex.printStackTrace();
                    }
                }
            }
        });
    }
    return saveButton;
}

else (
/ / Construction of the dialog for confirmation of the change
Root = new JPanel JPanel (new BorderLayout ());
JLabel message = new JLabel (
Updating the data of the cultural "
Bc.getNome + () + "with"
+ "Data form?");
message.setFont (new Font ( "Dialog", Font.BOLD, 14));
JLabel alert = new JLabel (
"The previous data can not be more recovered."
SwingConstants.CENTER);
Legal
. setIcon (new ImageIcon (
getClass ()
. getResource (
Home.URL_IMAGES + "warning16.png ")));
root.add (message, BorderLayout.NORTH);
root.add (notice, BorderLayout.CENTER);
String [] options = ( "Edit", "Cancel");
/ / The dialog screen appears
int choice = JOptionPane
. showInternalOptionDialog (
jContentPane,
root
"Edit Data Confirm Cultural Heritage"
JOptionPane.YES_NO_OPTION,
JOptionPane.QUESTION_MESSAGE,
new ImageIcon (
getClass ()
. getResource (
Home.URL_IMAGES + "ModificaBC48.png")),
options, options [1]);
/ / If you chose to confirm the change
if (choice == JOptionPane.YES_OPTION)
(
bc = riversaDatiNelBean ();
caricaDatiForm ();
attivaDisattivaEdit ();
btnSalva.setVisible (false);
btnAnnulla.setVisible (false);
btnModifica.setSelected (false);
mostraNascondiSuggerimenti ();
parent.updateTableModel (bc);
JOptionPane
. showInternalMessageDialog (
jContentPane,
The data of the cultural object has been updated successfully. "
"Data cultural change!"
JOptionPane.OK_OPTION,
new ImageIcon (
getClass ()
. getResource (
Home.URL_IMAGES + "ok32.png ")));
)
)
)
));
)
btnSalva return;
)

/**
 * This method initializes the button to clear the form (reset cultural asset data)
 * or reload the cultural data (modify data).
 *
 * @return javax.swing.JButton - the button.
 */
private JButton getCancelButton() {
    if (null == cancelButton) {
        cancelButton = new JButton();
        cancelButton.setText("Cancel");
        cancelButton.setIcon(new ImageIcon(getClass().getResource(Home.URL_IMAGES + "Cancel32.png")));
        cancelButton.setCursor(Cursor.getPredefinedCursor(Cursor.HAND_CURSOR));
        cancelButton.setVisible(false);
        cancelButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent arg0) {
                if (ca == null) {
                    Component[] components = dataBC.getComponents();
                    for (int i = 0; i < components.length; i++) {
                        Component current = components[i];
                        if (current instanceof JTextComponent) {
                            ((JTextComponent) current).setText("");
                        } else if (current instanceof JComboBox) {
                            JComboBox combo = (JComboBox) current;
                            combobox.setSelectedIndex(-1);
                        }
                    }
                    tagPanel.clear();
                    descriptionBC.setText("");
                } else {
                    loadDataForm();
                }
            }
        });
    }
    return cancelButton;
}

/**
 * This method initializes the button to edit a comment.
 *
 * @return javax.swing.JButton - the button to edit a comment.
 */
private JButton getEditCommentButton() {
    if (null == editCommentButton) {
        editCommentButton = new JButton();
        editCommentButton.setText("Edit Comment");
        editCommentButton.setIcon(new ImageIcon(getClass().getResource(Home.URL_IMAGES + "editComment.png")));
        editCommentButton.setVisible(false);
        editCommentButton.setEnabled(false);
        editCommentButton.addActionListener(new ActionListener() {
            ...
        });
    }
    return editCommentButton;
}


public void actionPerformed(ActionEvent pEvent) {
    int selectedRow = tableFeedback.getSelectedRow();
    String newComment = (String) JOptionPane.showInternalInputDialog(
            jContentPane,
            "Edit the selected comment:",
            "Edit Comment",
            JOptionPane.QUESTION_MESSAGE,
            new ImageIcon(getClass().getResource(Home.URL_IMAGES + "editComment.png")),
            null,
            feedbackModel.getValueAt(selectedRow, 1));
    if (newComment != null) {
        feedbackModel.modifyComment(newComment, selectedRow);
    }
}

private JPanel getDataBCForm() {
    if (null == dataBC) {
        dataBC = new JPanel(null);
        dataBC.setBorder(new SoftBevelBorder(SoftBevelBorder.LOWERED));

        // Creating tooltips
        for (int i = 0; i < tips.length; i++) {
            JLabel newTip = new JLabel();
            newTip.setIcon(new ImageIcon(getClass().getResource(Home.URL_IMAGES + "Info16.png")));
            newTip.setBounds(145, 8 + 30 * i, 24, 24);
            newTip.setCursor(Cursor.getPredefinedCursor(Cursor.HAND_CURSOR));
            newTip.setToolTipText(tips[i]);
            suggestions.add(newTip);
            dataBC.add(newTip);
            if (i == tips.length - 1) {
                newTip.setBounds(400, 155, 24, 24);
            }
        }

        for (int i = 0; i < labels.length; i++) {
            JLabel newLabel = new JLabel(labels[i], SwingConstants.RIGHT);
            newLabel.setBounds(25, 10 + 30 * i, 120, 16);
            newLabel.repaint();
            dataBC.add(newLabel, null);
        }

        // Name of Cultural Heritage
        nameBC = new JTextField();
        nameBC.setColumns(12);
        nameBC.setDocument(new LimitedDocument(30));
        nameBC.setBounds(185, 10, 136, 20);
        nameBC.setName("Name of Cultural Heritage");
        dataBC.add(nameBC, null);

        // Address
        address2 = new JTextField();
        address2.setBounds(270, 40, 136, 20);
        address2.setDocument(new LimitedDocument(30));
        address1 = new JComboBox(address);
        address1.setSelectedIndex(-1);
        address1.setBounds(185, 40, 60, 20);
        address2.setName("Address");
        dataBC.add(address2, null);
        dataBC.add(address1, null);

        // City
        cityBC = new JTextField();
        cityBC.setColumns(12);
        cityBC.setBounds(185, 70, 136, 20);
        cityBC.setName("City");
        cityBC.setDocument(new OnlyCharactersDocument(25));
        dataBC.add(cityBC);

        // Location
        localityBC = new JTextField();
        localityBC.setBounds(185, 100, 136, 20);
        localityBC.setName("Location");
        localityBC.setDocument(new OnlyCharactersDocument(25));
        dataBC.add(localityBC, null);

        // Postal Code
        postalCodeBC = new JTextField();
        postalCodeBC.setColumns(8);
        postalCodeBC.setBounds(185, 130, 92, 20);
        postalCodeBC.setDocument(new NumericDocument(5));
        dataBC.add(postalCodeBC, null);
    }
    return dataBC;
}



/ / Geographical Location
JLabel txtX = new JLabel ( "X");
JLabel txtY = new JLabel ( "Y");
JLabel txtZ = new JLabel ( "Z");
New fonts = new Font ( "Dialog", Font.BOLD, 14);
txtX.setFont (new);
txtY.setFont (new);
txtZ.setFont (new);
txtZ.setBounds (365, 190, 10, 22);
txtY.setBounds (295, 190, 10, 22);
txtX.setBounds (227, 190, 14, 20);
posGeoX = new JTextField (12);
posGeoX.setBounds (185, 190, 40, 20);
posGeoY = new JTextField (12);
posGeoY.setBounds (255, 190, 40, 20);
posGeoZ = new JTextField (12);
posGeoZ.setBounds (325, 190, 40, 20);
posGeoX.setName ( "X-coordinate");
posGeoY.setName ( "Y coordinate");
posGeoZ.setName ( "z coordinate");
datiBC.add (txtX, null);
datiBC.add (txtY, null);
datiBC.add (txtZ, null);
datiBC.add (posGeoX, null);
datiBC.add (posGeoY, null);
datiBC.add (posGeoZ, null);

/// State
provBC = new JComboBox(province);
provBC.setSelectedIndex(-1);
provBC.setBounds(185, 160, 50, 20);
dataBC.add(provBC, null);

// Description
descrizioneBC = new JTextArea();
descrizioneBC.setCursor(new Cursor(Cursor.TEXT_CURSOR));
descrizioneBC.setWrapStyleWord(true);
descrizioneBC.setLineWrap(true);
JScrollPane = new JScrollPane(descrizioneBC);
JScrollPane.setVerticalScrollBarPolicy(JScrollPane.VERTICAL_SCROLLBAR_ALWAYS);
jScrollPane.setBounds(new Rectangle(185, 370, 395, 69));
descrizioneBC.setName("Description");
dataBC.add(jScrollPane, null);

// Phone
telefonoBC = new JTextField(12);
telefonoBC.setBounds(185, 220, 136, 20);
telefonoBC.setDocument(new NumericDocument(10));
telefonoBC.setName("Phone");
dataBC.add(telefonoBC, null);

// Opening
hoursOP = new JComboBox();
hoursOP.setBounds(185, 250, 40, 20);
hoursCL = new JComboBox();
hoursCL.setBounds(185, 280, 40, 20);
for (int i = 0; i < 24; i++) {
    if (i < 10) {
        hoursCL.addItem("0" + i);
        hoursOP.addItem("0" + i);
    } else {
        hoursOP.addItem(i);
        hoursCL.addItem(i);
    }
}
minutesOP = new JComboBox();
minutesOP.setBounds(241, 250, 40, 20);
minutesOP.addItem("00");
minutesOP.addItem("15");
minutesOP.addItem("30");
minutesOP.addItem("45");
minutesCL = new JComboBox();
minutesCL.setBounds(241, 280, 40, 20);
minutesCL.addItem("00");
minutesCL.addItem("15");
minutesCL.addItem("30");
minutesCL.addItem("45");
minutesOP.setSelectedIndex(0);
hoursOP.setSelectedIndex(-1);
minutesCL.setSelectedIndex(0);
hoursCL.setSelectedIndex(-1);
newFont = new Font("Dialog", Font.BOLD, 18);
labelColon1 = new JLabel(":");
labelColon1.setBounds(230, 245, 10, 24);
labelColon1.setFont(newFont);
JLabel labelColon2 = new JLabel(":");
labelColon2.setBounds(230, 275, 10, 24);
labelColon2.setFont(newFont);
dataBC.add(hoursOP, null);
dataBC.add(minutesOP, null);
dataBC.add(minutesCL, null);
dataBC.add(hoursCL, null);
dataBC.add(labelColon1, null);
dataBC.add(labelColon2, null);

// Closed
String[] days = {"Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"};
dayClosure = new JComboBox(days);
dayClosure.setBounds(185, 310, 96, 20);
dayClosure.setSelectedIndex(-1);
dataBC.add(dayClosure, null);

// Cost
costBC = new JTextField();
costBC.setColumns(8);
costBC.setBounds(185, 340, 40, 20);
JLabel euro = new JLabel("Euro");
euro.setBounds(230, 340, 30, 16);
dataBC.add(costBC, null);
dataBC.add(euro, null);

// TagPanel
tagPanel = new TagPanel();
tagPanel.setBounds(405, 180, 180, 170);
JLabel lblTag = new JLabel("Search Tags");
lblTag.setBounds(420, 150, 140, 30);
dataBC.add(lblTag, null);
dataBC.add(tagPanel, null);

return dataBC;


/ **
* This method initializes the panel of statistics for the current month.
*
* @ Return javax.swing.JPanel - the panel of statistics for the current month.
*
* /
private JPanel getCurrentMonthStats()
{
    if (currentMonthStats == null)
    {
        currentMonthStats = new JPanel();
        currentMonthStats.setLayout(new GridBagLayout());
        currentMonthStats.setPreferredSize(new Dimension(500, 280));
        currentMonthStats.setBorder(BorderFactory.createTitledBorder(
                BorderFactory.createLineBorder(new Color(51, 102, 255), 3),
                "Statistics Current Month",
                TitledBorder.DEFAULT_JUSTIFICATION,
                TitledBorder.DEFAULT_POSITION, new Font("Dialog", Font.BOLD, 12),
                new Color(0, 102, 204)));
        currentMonthStats.setBackground(Color.white);
        statMeseC = new JButton[6];
        GridBagConstraints g = new GridBagConstraints();
        g.gridx = 0;
        g.gridy = 0;
        g.gridwidth = 3;
        g.insets = new Insets(5, 5, 5, 8);
        g.anchor = GridBagConstraints.WEST;
        currentMonthStats.add(new JLabel("Details of votes received this month:"), g);
        g.anchor = GridBagConstraints.CENTER;
        g.gridwidth = 1;
        Font newFont = new Font("Dialog", Font.BOLD, 16);
        for (int i = 5; i >= 1; i--) {
            int gridX = g.gridx;
            g.gridy++;
            JLabel aLabel = new JLabel(new ImageIcon(getClass().getResource(
                    Home.URL_IMAGES + "star" + i + ".gif")), JLabel.CENTER);
            currentMonthStats.add(aLabel, g);
            g.gridx++;
            currentMonthStats.add(new JLabel("=="), g);
            g.gridx++;
            g.anchor = GridBagConstraints.EAST;
            statMeseC[i - 1] = new JButton();
            statMeseC[i - 1].setFont(newFont);
            currentMonthStats.add(statMeseC[i - 1], g);
            g.gridx = gridX;
            g.anchor = GridBagConstraints.CENTER;
        }
    }
    return currentMonthStats;
}

g.gridy = 6;
g.anchor = GridBagConstraints.WEST;
g.gridwidth = 2;
g.gridx = 0;
statMeseCorrente.add (new JLabel (
"Number of ratings released this month:"), g);
statMeseC [5] = new JLabel ();
statMeseC [5]. setFont (new Font ( "Dialog", Font.BOLD, 18));
g.gridx = 2;
g.gridwidth = 1;
statMeseCorrente.add (statMeseC [5], g);

)
statMeseCorrente return;
)

/ **
* This method initializes the panel on the total statistics
* The cultural property.
*
* @ Return javax.swing.JPanel - the panel statistics totals.
*
* /
/ **
* This method initializes the panel of total statistics.
*
* @ Return javax.swing.JPanel - the panel of total statistics.
*
* /
private JPanel getTotalStats()
{
    if (null == totalStats)
    {
        totalStats = new JPanel();
        totalStats.setLayout(new GridBagLayout());
        totalStats.setPreferredSize(new Dimension(500, 280));
        totalStats.setBorder(BorderFactory.createTitledBorder(
                BorderFactory.createLineBorder(new Color(51, 102, 255), 3),
                "Total Statistics",
                TitledBorder.DEFAULT_JUSTIFICATION,
                TitledBorder.DEFAULT_POSITION, new Font("Dialog", Font.BOLD, 12),
                new Color(0, 102, 204)));
        totalStats.setBackground(Color.white);
        statt = new JButton[6];
        GridBagConstraints g = new GridBagConstraints();
        g.gridx = 0;
        g.gridy = 0;
        g.gridwidth = 3;
        g.insets = new Insets(5, 5, 5, 8);
        g.anchor = GridBagConstraints.WEST;
        totalStats.add(new JLabel("Details of votes received this month:"), g);
        g.anchor = GridBagConstraints.CENTER;
        g.gridwidth = 1;
        Font newFont = new Font("Dialog", Font.BOLD, 16);
        for (int i = 5; i >= 1; i--)
        {
            int gridX = g.gridx;
            g.gridy++;
            JLabel aLabel = new JLabel(new ImageIcon(getClass()
                    .getResource(Home.URL_IMAGES + "star" + i + ".gif")), JLabel.CENTER);
            totalStats.add(aLabel, g);
            g.gridx++;
            totalStats.add(new JLabel("=="), g);
            g.gridx++;
            g.anchor = GridBagConstraints.EAST;
            statt[i - 1] = new JButton();
            statt[i - 1].setFont(newFont);
            totalStats.add(statt[i - 1], g);
            g.gridx = gridX;
            g.anchor = GridBagConstraints.CENTER;
        }
    }
    return totalStats;
}

for (int i = 5; i> = 1, i -)
(
int gridX = g.gridx;
g.gridy + +;
JLabel aLabel = new JLabel (new ImageIcon (getClass ()
. getResource (
"/ unisa / gps / eTour / gui / images / star" + i
+. "Gif")), JLabel.CENTER);
statTotali.add (aLabel, g);
g.gridx + +;
statTotali.add (new JLabel ("=="), g);
g.gridx + +;
g.anchor = GridBagConstraints.EAST;
statt [i - 1] = new JLabel ();
statt [i - 1]. setFont (new);
statTotali.add (statt [i - 1], g);
g.gridx = gridX;
g.anchor = GridBagConstraints.CENTER;
)
g.gridy = 6;
g.anchor = GridBagConstraints.WEST;
g.gridwidth = 2;
g.gridx = 0;
statTotali.add (new JLabel (
"Number of ratings released this month:"), g);
statt [5] = new JLabel ();
statt [5]. setFont (new Font ( "Dialog", Font.BOLD, 18));
g.gridx = 2;
g.gridwidth = 1;
statTotali.add (statt [5], g);
)
statTotali return;
)

private BeanCulturalAsset transferDataToBean() {
    BeanCulturalAsset newAsset = new BeanCulturalAsset();
    newAsset.setName(nameBC.getText());
    newAsset.setDescription(descriptionBC.getText());
    newAsset.setPostalCode(capBC.getText());
    newAsset.setTicketCost(Double.parseDouble(costBC.getText()));
    newAsset.setClosingDay((String) closingDay.getSelectedItem());
    newAsset.setPhoneNumber(phoneBC.getText());
    newAsset.setCity(cityBC.getText());
    newAsset.setLocation(locationBC.getText());
    // Date (int year, int month, int date, int hrs, int min)
    Date openingTime = new Date(0, 0, 0, hourOpening.getSelectedIndex(), minuteOpening.getSelectedIndex());
    Date closingTime = new Date(0, 0, 0, hourClosing.getSelectedIndex(), minuteClosing.getSelectedIndex());
    newAsset.setOpeningTime(openingTime);
    newAsset.setClosingTime(closingTime);
    newAsset.setProvince((String) provinceBC.getSelectedItem());
    newAsset.setAddress(((String) address1.getSelectedItem()) + " " + address2.getText());
    Point3D position = new Point3D(Double.parseDouble(geoPosX.getText()), 
                                   Double.parseDouble(geoPosY.getText()), 
                                   Double.parseDouble(geoPosZ.getText()));
    newAsset.setPosition(position);
    return newAsset;
}

private void loadTags() {
    ArrayList<BeanTag> beanTags = null;
    try {
        beanTags = tag.getTags();
        if (bc != null) {
            ArrayList<Integer> tagIds = new ArrayList<>();
            ArrayList<BeanTag> selectedTags = managementBC.getAssetTags(bc.getId());
            for (BeanTag b : selectedTags) {
                tagIds.add(b.getId());
            }
        }
    } catch (RemoteException e) {
        // If an error occurs, the tag panel remains blank
    } finally {
        for (BeanTag b : beanTags) {
            tagPanel.insertTag(b);
        }
        tagPanel.setSelectedTags(tagIds);
        tagPanel.repaint();
    }
}

